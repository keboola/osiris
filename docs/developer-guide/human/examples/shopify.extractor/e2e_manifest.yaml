# End-to-End Pipeline Manifest
# Tests shopify.extractor in a complete pipeline

oml_version: "0.1.0"
name: "shopify_extract_customers"
description: "Extract Shopify customers and write to CSV"

steps:
  - id: extract_customers
    component: shopify.extractor
    mode: extract
    config:
      connection: "@shopify.default"
      resource: "customers"
      limit: 100
    outputs:
      - df

  - id: write_csv
    component: filesystem.csv_writer
    mode: write
    inputs:
      df: "${extract_customers.df}"
    config:
      path: "output/shopify_customers.csv"
      mode: "overwrite"

# To run this pipeline:
#   1. Set up connection:
#      export SHOPIFY_ACCESS_TOKEN="shpat_xxxxx"  # pragma: allowlist secret
#
#   2. Compile:
#      osiris compile e2e_manifest.yaml
#
#   3. Run locally:
#      osiris run --last-compile --verbose
#
#   4. Run in E2B (if E2B_API_KEY set):
#      osiris run --last-compile --e2b --verbose
#
#   5. View output:
#      cat output/shopify_customers.csv
